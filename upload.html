<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Upload Presentation</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
    <div class="container">
        <header>
            <h1>Upload Your Presentation</h1>
            <p>Fill in your details and upload your PPT or PDF file.</p>
        </header>

        <main>
            <form id="upload-form" class="upload-form">
                <input type="hidden" id="sessionId" name="sessionId" />
                <label for="name">Name</label>
                <input type="text" id="name" name="name" placeholder="Your Name" required />

                <label for="rollNumber">Roll Number</label>
                <input type="text" id="rollNumber" name="rollNumber" placeholder="Your Roll Number" required />

                <label for="file">Select File (.ppt, .pptx, .pdf)</label>
                <input type="file" id="file" name="file" accept=".ppt,.pptx,.pdf" required />

                <button type="submit" class="btn">Upload</button>
            </form>

            <div id="message" class="message"></div>
        </main>
    </div>
       <footer>
               <p>Developed by Himanshu Vk</p>
       </footer>


    <script>
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session');
    const sessionInput = document.getElementById('sessionId');
    const form = document.getElementById('upload-form');
    const messageDiv = document.getElementById('message');

    // Create progress bar
    const progressBar = document.createElement('progress');
    progressBar.value = 0;
    progressBar.max = 100;
    progressBar.style.display = 'none';
    progressBar.style.width = '100%';
    progressBar.style.marginTop = '10px';
    form.appendChild(progressBar);

    if (!sessionId) {
        messageDiv.textContent = 'Invalid session. Please scan a valid QR code.';
        form.style.display = 'none';
        return;
    }

    sessionInput.value = sessionId;

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        messageDiv.textContent = '';
        progressBar.value = 0;
        progressBar.style.display = 'block';
        progressBar.style.height = '15px';

        const formData = new FormData(form);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', `${window.location.origin}/upload`, true);

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = (e.loaded / e.total) * 100;
                progressBar.value = percent;
                messageDiv.textContent = `⏳ Uploading... ${Math.round(percent)}%`;
                messageDiv.style.color = 'blue';
            }
        };

        xhr.onload = () => {
            if (xhr.status === 200) {
                messageDiv.textContent = '✅ File uploaded successfully!';
                messageDiv.style.color = 'green';
                progressBar.value = 100;
                setTimeout(() => {
                    progressBar.style.display = 'none';
                    form.reset();
                }, 1000);
            } else {
                messageDiv.textContent = '❌ Upload failed.';
                messageDiv.style.color = 'red';
            }
        };

        xhr.onerror = () => {
            messageDiv.textContent = '⚠️ Network error. Please try again.';
            messageDiv.style.color = 'red';
            progressBar.style.display = 'none';
        };

        xhr.send(formData);
    });
});
</script>

</body>
</html>
